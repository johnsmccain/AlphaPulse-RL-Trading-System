# Fluentd configuration for AlphaPulse-RL log aggregation

<source>
  @type tail
  path /fluentd/log/*.log
  pos_file /fluentd/log/alphapulse.log.pos
  tag alphapulse.system
  format json
  time_key timestamp
  time_format %Y-%m-%d %H:%M:%S
</source>

<source>
  @type tail
  path /fluentd/log/trades.csv
  pos_file /fluentd/log/trades.csv.pos
  tag alphapulse.trades
  format csv
  keys timestamp,pair,action,entry_price,exit_price,pnl,confidence,market_regime
  time_key timestamp
  time_format %Y-%m-%d %H:%M:%S
</source>

<source>
  @type tail
  path /fluentd/log/ai_decisions.json
  pos_file /fluentd/log/ai_decisions.json.pos
  tag alphapulse.decisions
  format json
  time_key timestamp
  time_format %Y-%m-%d %H:%M:%S
</source>

# Filter for error detection
<filter alphapulse.**>
  @type grep
  <regexp>
    key level
    pattern ERROR|CRITICAL
  </regexp>
</filter>

# Store logs in Redis for monitoring dashboard
<match alphapulse.**>
  @type redis_store
  host redis
  port 6379
  db_number 1
  key_name alphapulse_logs
  store_type list
  max_length 1000
  flush_interval 10s
</match>

# Forward critical errors to alerting system
<match alphapulse.system>
  @type copy
  <store>
    @type redis_store
    host redis
    port 6379
    db_number 2
    key_name alphapulse_alerts
    store_type list
    max_length 100
    flush_interval 5s
  </store>
</match>